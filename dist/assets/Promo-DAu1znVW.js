import{a as u,r as c,j as r,M as Y,B as D,b,c as _,I,T as x}from"./index-BCMjTDj-.js";import{h as v}from"./moment-G82_0lEo.js";import{d as $}from"./Add-ARitWxv6.js";import{T as J,a as V,b as G,c as E,d as B,e as K}from"./TableRow-C6k8ikuc.js";import{E as Q,D as X}from"./Edit-Bd8MNGzJ.js";import{T as Z}from"./TablePagination-au4wXnx7.js";import{D as ee,a as re}from"./DialogTitle-D85XLa7F.js";import{D as oe}from"./DialogActions-Db_kJuz6.js";import"./LastPage-aK0Jz_ev.js";const te=async(n,s)=>{try{const o=await u.post("https://executivetracking.cloudjiffy.net/Mahaasabha/promo/v1/createPromo",n,{headers:s});o.data.responseCode===201?alert("Promo added successfully"):alert(o.data.errorMessage||"An error occurred")}catch(o){alert("Error adding promo: "+o.message),console.error("Error adding promo:",o)}},ae=async n=>{try{return(await u.get("https://executivetracking.cloudjiffy.net/Mahaasabha/promo/v1/getAllPromoByPagination/{pageNumber}/{pageSize}?pageNumber=0&pageSize=10",{headers:n})).data}catch(s){throw console.error("Error fetching promo data:",s),s}},se=async(n,s)=>{try{return(await u.get(`https://executivetracking.cloudjiffy.net/Mahaasabha/promo/v1/getPromoByPromoId/{promoId}?promoId=${s}`,{headers:n})).data}catch(o){throw console.error("Error fetching promo by ID:",o),o}},ne=async(n,s)=>{try{const o=await u.put("https://executivetracking.cloudjiffy.net/Mahaasabha/promo/v1/updatePromo",n,{headers:s});o.data.responseCode===201?alert(o.data.message):alert(o.data.errorMessage||"An unexpected error occurred")}catch(o){console.error("Error updating promo:",o),alert("Error updating promo: "+o.message)}},ie=async(n,s)=>{try{const o=await u.delete(`https://executivetracking.cloudjiffy.net/Mahaasabha/promo/v1/deletePromoById/${s}`,{headers:n});o.data.responseCode===200?alert(o.data.message):alert(o.data.errorMessage||"An unexpected error occurred")}catch(o){console.error("Error deleting promo:",o),alert("Error deleting promo: "+o.message)}},C=[{id:"promoId",label:"ID"},{id:"promoName",label:"Name",minWidth:100},{id:"description",label:"Description",minWidth:100},{id:"youTube",label:"Youtube"},{id:"createdBy",label:"Created By",align:"right"},{id:"updatedBy",label:"Updated By",align:"right"},{id:"insertedDate",label:"Inserted Date",align:"right"},{id:"updatedDate",label:"Updated Date",align:"right"},{id:"actions",label:"Actions",align:"right"}],fe=()=>{const[n,s]=c.useState(0),[o,w]=c.useState(10),[j,k]=c.useState([]),[S,m]=c.useState(!1),[g,T]=c.useState(!1),[l,P]=c.useState({}),[A,M]=c.useState(null),[U,R]=c.useState(!1),[a,h]=c.useState({promoName:"",description:"",youTube:""}),W=(e,t)=>{s(t)},z=e=>{w(+e.target.value),s(0)},y=JSON.parse(sessionStorage.getItem("user")),p={"Content-type":"application/json",Authorization:"Bearer "+y.accessToken},f=e=>{h({...a,[e.target.name]:e.target.value}),P({...l,[e.target.name]:null})},F=()=>{const e={};return(!a.promoName||a.promoName.trim()==="")&&(e.promoName="Enter the Advertisement name"),(!a.description||a.description.trim()==="")&&(e.description="Enter the description"),(!a.youTube||a.youTube.trim()==="")&&(e.youTube="Enter the YouTube URL"),e},N=async()=>{try{const i=((await ae(p)).content||[]).map(d=>({promoId:d.promoId,promoName:d.promoName,description:d.description,youTube:d.youTube,insertedDate:v(d.insertedDate).format("L"),updatedDate:v(d.updatedDate).format("L"),createdBy:d.createdBy&&d.createdBy.userName||"No User",updatedBy:d.updatedBy&&d.updatedBy.userName||"No User"}));k(i)}catch(e){console.error("Error fetching promo data:",e)}};c.useEffect(()=>{N()},[U]);const L=async e=>{await ie(p,e),N()},O=async e=>{T(!0),m(!0);try{const t=await se(p,e);t?(M(t.promoId),h({promoName:t.promoName,description:t.description,youTube:t.youTube})):console.error("No promo data found for id:",e)}catch(t){console.error("Error fetching promo details:",t)}},q=()=>{T(!1),h({promoName:"",description:"",youTube:""}),m(!0)},H=async e=>{e.preventDefault();const t=F();if(Object.keys(t).length>0)P(t);else try{if(g){const i={promoId:A,promoName:a.promoName,description:a.description,youTube:a.youTube,updatedBy:{userId:y.userId}};await ne(i,p)}else{const i={promoName:a.promoName,description:a.description,youTube:a.youTube,createdBy:{userId:y.userId}};await te(i,p)}h({promoName:"",description:"",youTube:""}),m(!1),R(i=>!i)}catch(i){console.error("Error saving promo:",i)}};return r.jsxs(Y,{title:r.jsxs(D,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsx("span",{children:"Promo"}),r.jsxs(b,{variant:"contained",color:"primary",sx:{display:"flex",alignItems:"center",fontSize:"15px"},onClick:q,children:["Add",r.jsx($,{})]})]}),children:[r.jsxs(_,{sx:{width:"100%",overflow:"hidden"},children:[r.jsx(J,{children:r.jsxs(V,{stickyHeader:!0,children:[r.jsx(G,{children:r.jsx(E,{children:C.map(e=>r.jsx(B,{align:e.align,style:{minWidth:e.minWidth},children:e.label},e.id))})}),r.jsx(K,{children:j.slice(n*o,n*o+o).map(e=>r.jsx(E,{hover:!0,role:"checkbox",tabIndex:-1,children:C.map(t=>{const i=e[t.id];return r.jsx(B,{align:t.align,children:t.id==="youTube"?r.jsxs("a",{href:i,target:"_blank",rel:"noopener noreferrer",children:[i," "]}):t.id==="actions"?r.jsxs(r.Fragment,{children:[r.jsx(I,{color:"primary",onClick:()=>O(e.promoId),children:r.jsx(Q,{})}),r.jsx(I,{color:"secondary",onClick:()=>L(e.promoId),children:r.jsx(X,{})})]}):i},t.id)})},e.promoId))})]})}),r.jsx(Z,{rowsPerPageOptions:[10,25,100],component:"div",count:j.length,rowsPerPage:o,page:n,onPageChange:W,onRowsPerPageChange:z})]}),r.jsxs(ee,{open:S,onClose:()=>m(!1),children:[r.jsx(re,{children:g?"Edit Promo":"Add Promo"}),r.jsxs(D,{component:"form",onSubmit:H,noValidate:!0,sx:{m:2},children:[r.jsx(x,{required:!0,name:"promoName",label:"Promo Name",value:a.promoName,onChange:f,error:!!l.promoName,helperText:l.promoName,fullWidth:!0}),r.jsx(x,{required:!0,name:"description",label:"Description",value:a.description,onChange:f,error:!!l.description,helperText:l.description,fullWidth:!0,multiline:!0,rows:3}),r.jsx(x,{required:!0,name:"youTube",label:"YouTube URL",value:a.youTube,onChange:f,error:!!l.youTube,helperText:l.youTube,fullWidth:!0}),r.jsxs(oe,{children:[r.jsx(b,{onClick:()=>m(!1),color:"primary",children:"Cancel"}),r.jsx(b,{type:"submit",color:"primary",children:g?"Update":"Add"})]})]})]})]})};export{fe as default};
