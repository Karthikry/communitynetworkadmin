import{r,j as t,c as J,b as f,I as C,T as O}from"./index-Djsfy_Oq.js";import{d as M}from"./Edit-CWCknw8m.js";import{d as R}from"./Delete-CtFrHhEW.js";import{T as U,a as H,b as L,c as x,d as y,e as _,f as G}from"./TableRow-DpUlrRrC.js";import{D as q,a as K}from"./DialogTitle-s7brXHWk.js";import{D as Q}from"./DialogContent-DHscOiCv.js";import{D as V}from"./DialogActions-hyJVfphP.js";const b=[{id:"occupationId",label:"ID",minWidth:50},{id:"occupationName",label:"Occupation Name",minWidth:150},{id:"description",label:"Description",minWidth:200},{id:"createdBy",label:"Created By",minWidth:150},{id:"updatedBy",label:"Updated By",minWidth:150},{id:"insertedDate",label:"Inserted Date",minWidth:180},{id:"updatedDate",label:"Updated Date",minWidth:180},{id:"actions",label:"Actions",minWidth:100,align:"center"}],ne=()=>{const[h,N]=r.useState(0),[m,S]=r.useState(10),[j,v]=r.useState([]),[k,I]=r.useState(0),[D,d]=r.useState(null),[B,T]=r.useState(!1),[g,E]=r.useState("add"),[i,l]=r.useState({occupationId:0,occupationName:"",description:""});r.useEffect(()=>{u()},[h,m]);const u=async()=>{try{const e=JSON.parse(sessionStorage.getItem("user")),o=(e==null?void 0:e.accessToken)||"",a=await fetch(`https://executivetracking.cloudjiffy.net/Mahaasabha/gotra/v1/getAllOccupationByPagination/{pageNumber}/{pageSize}?pageNumber=${h}&pageSize=${m}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`}});if(!a.ok)throw new Error(`Error: ${a.statusText}`);const n=await a.json(),c=n.content.map(s=>({occupationId:s.occupationId,occupationName:s.occupationName,description:s.description,createdBy:s.createdBy.fullName||s.createdBy.userName,updatedBy:s.updatedBy.fullName||s.updatedBy.userName,insertedDate:new Date(s.insertedDate).toLocaleDateString(),updatedDate:new Date(s.updatedDate).toLocaleDateString()}));v(c),I(n.totalElements)}catch(e){d(e.message),console.error("Failed to fetch occupations:",e)}},P=(e,o)=>{N(o)},A=e=>{S(+e.target.value),N(0)},w=(e,o={})=>{E(e),l(o),T(!0)},p=()=>{T(!1),l({occupationId:0,occupationName:"",description:""})},W=async()=>{g==="add"?await $():await F()},$=async()=>{try{const e=JSON.parse(sessionStorage.getItem("user")||"{}"),o=(e==null?void 0:e.accessToken)||"",a={occupationName:i.occupationName,description:i.description,createdBy:{fullName:e.fullName||e.userName,mobileNumber:e.mobileNumber,userId:e.userId,userName:e.userName}},n=await fetch("https://executivetracking.cloudjiffy.net/Mahaasabha/gotra/v1/createOccupation",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(a)});if(!n.ok){const c=await n.json();throw console.error("Failed to add occupation:",c),new Error(`Error: ${n.statusText}`)}u(),p()}catch(e){d(e.message),console.error("Failed to add occupation:",e)}},F=async()=>{try{const e=JSON.parse(sessionStorage.getItem("user")||"{}"),o=(e==null?void 0:e.accessToken)||"",a={occupationId:i.occupationId,occupationName:i.occupationName,description:i.description,updatedBy:{fullName:e.fullName||e.userName,mobileNumber:e.mobileNumber,userId:e.userId,userName:e.userName}},n=await fetch("https://executivetracking.cloudjiffy.net/Mahaasabha/gotra/v1/updateOccupation",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(a)});if(!n.ok){const c=await n.json();throw console.error("Failed to edit occupation:",c),new Error(`Error: ${n.statusText}`)}u(),p()}catch(e){d(e.message),console.error("Failed to edit occupation:",e)}},z=async e=>{if(window.confirm("Are you sure you want to delete this occupation?"))try{const a=JSON.parse(sessionStorage.getItem("user")||"{}"),n=(a==null?void 0:a.accessToken)||"",c=await fetch(`https://executivetracking.cloudjiffy.net/Mahaasabha/gotra/v1/deleteOccupationById/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}});if(!c.ok){const s=await c.json();throw console.error("Failed to delete occupation:",s),new Error(`Error: ${c.statusText}`)}u()}catch(a){d(a.message),console.error("Failed to delete occupation:",a)}};return t.jsxs(J,{sx:{width:"100%",overflow:"hidden",mt:5},children:[t.jsx(f,{variant:"contained",sx:{margin:"10px"},onClick:()=>w("add"),children:"+ ADD OCCUPATION"}),D&&t.jsxs("div",{style:{color:"red",textAlign:"center"},children:["Error: ",D]}),t.jsx(U,{sx:{maxHeight:440},children:t.jsxs(H,{stickyHeader:!0,"aria-label":"sticky table",children:[t.jsx(L,{children:t.jsx(x,{children:b.map(e=>t.jsx(y,{align:e.align||"left",style:{minWidth:e.minWidth,fontWeight:"bold"},children:e.label},e.id))})}),t.jsx(_,{children:j.length>0?j.map(e=>t.jsx(x,{hover:!0,role:"checkbox",tabIndex:-1,children:b.map(o=>{const a=e[o.id];return t.jsx(y,{align:o.align||"left",children:o.id==="actions"?t.jsxs(t.Fragment,{children:[t.jsx(C,{onClick:()=>w("edit",e),color:"primary",children:t.jsx(M,{})}),t.jsx(C,{onClick:()=>z(e.occupationId),color:"secondary",children:t.jsx(R,{})})]}):a||"Not Available"},o.id)})},e.occupationId)):t.jsx(x,{children:t.jsx(y,{colSpan:b.length,align:"center",sx:{padding:20},children:"No rows"})})})]})}),t.jsx(G,{rowsPerPageOptions:[10,25,100],component:"div",count:k,rowsPerPage:m,page:h,onPageChange:P,onRowsPerPageChange:A}),t.jsxs(q,{open:B,onClose:p,children:[t.jsx(K,{children:g==="add"?"Add Occupation":"Edit Occupation"}),t.jsxs(Q,{children:[t.jsx(O,{autoFocus:!0,margin:"dense",label:"Occupation Name",fullWidth:!0,variant:"outlined",value:i.occupationName,onChange:e=>l({...i,occupationName:e.target.value})}),t.jsx(O,{margin:"dense",label:"Description",fullWidth:!0,variant:"outlined",value:i.description,onChange:e=>l({...i,description:e.target.value})})]}),t.jsxs(V,{children:[t.jsx(f,{onClick:p,children:"Cancel"}),t.jsx(f,{onClick:W,children:g==="add"?"Add":"Save"})]})]})]})};export{ne as default};
