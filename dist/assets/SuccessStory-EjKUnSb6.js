import{a as u,u as Z,r as n,j as e,M as ee,b as y,G as f,g as te,c as se,I as T,T as x}from"./index-Djsfy_Oq.js";import{h as E}from"./moment-G82_0lEo.js";import{d as ae}from"./Add-D7Eq1Nxw.js";import{d as re}from"./Edit-CWCknw8m.js";import{d as oe}from"./DeleteForever-DYpYIOBT.js";import{B as k}from"./Box-DEFhJFtP.js";import{T as ce,a as ne,b as ie,c as M,d as F,e as le,f as de}from"./TableRow-DpUlrRrC.js";import{D as ue,a as he}from"./DialogTitle-s7brXHWk.js";import{D as pe}from"./DialogActions-hyJVfphP.js";const me=async o=>await u({method:"get",url:"https://executivetracking.cloudjiffy.net/Mahaasabha/success/v1/getAllSuccessStoryByPagination/{pageNumber}/{pageSize}?pageNumber=0&pageSize=10",headers:o}),fe=async(o,l)=>await u({method:"GET",url:`https://executivetracking.cloudjiffy.net/Mahaasabha/success/v1/getSuccessStoryById/{successstoryId}?successstoryId=${o}`,headers:l}),ge=async(o,l)=>(console.log(o),await u({method:"PUT",url:"https://executivetracking.cloudjiffy.net/Mahaasabha/success/v1/updateSuccessStory",headers:l,data:o}).then(function(s){console.log(s),s.data.responseCode===201?alert(s.data.message):s.data.responseCode===400&&alert(s.data.errorMessage)}).catch(function(s){console.log(s)})),ye=async(o,l)=>await u({method:"delete",url:`https://executivetracking.cloudjiffy.net/Mahaasabha/success/v1/deleteSuccessStoryById/${o}`,headers:l}).then(s=>{s.data.responseCode===200?alert(s.data.message):s.data.responseCode===400&&alert(s.data.errorMessage)}).catch(s=>{console.log(s)}),xe=async(o,l)=>{try{return await u({method:"POST",url:"https://executivetracking.cloudjiffy.net/Mahaasabha/success/v1/createSuccessStory",headers:l,data:o}).then(function(s){console.log(s),s.data.responseCode===201?alert("Advertisement  added successfully"):s.data.responseCode===400&&alert(s.data.errorMessage)})}catch(s){alert(s)}},A=[{id:"successstoryId",label:"ID"},{id:"successstoryName",label:"Name",minWidth:100},{id:"description",label:"Description",minWidth:100},{id:"file",label:"File"},{id:"createdBy",label:"Created By",align:"right"},{id:"updatedBy",label:"Updated By",align:"right"},{id:"insertedDate",label:"Inserted Date",align:"right"},{id:"updatedDate",label:"Updated Date",align:"right"},{id:"actions",label:"Actions",align:"right"}],Te=()=>{Z();const[o,l]=n.useState(0),[s,U]=n.useState(10),[S,j]=n.useState([]),[N,b]=n.useState(!1),[W,h]=n.useState(!1),[R,z]=n.useState(null),[Se,v]=n.useState(""),[d,w]=n.useState({}),[I,O]=n.useState(null),D=n.useRef(null),[je,C]=n.useState(""),[$,P]=n.useState(!1),[i,p]=n.useState({successstoryName:"",description:""}),G=(t,a)=>{l(a)},H=t=>{U(+t.target.value),l(0)},g=JSON.parse(sessionStorage.getItem("user")),m={"Content-type":"application/json",Authorization:`Bearer ${g.accessToken}`},_="https://executivetracking.cloudjiffy.net/Mahaasabha/file/downloadFile/?filePath=",L=async()=>{try{const a=(await me(m)).data.content;if(a){const r=a.map(c=>({successstoryId:c.successstoryId,successstoryName:c.successstoryName,description:c.description,file:c.photoPath?e.jsx("img",{src:_+c.photoPath,alt:c.photoName,style:{width:100,height:50}}):"NO IMAGE FOUND",insertedDate:E(c.insertedDate).format("L"),updatedDate:E(c.updatedDate).format("L"),createdBy:c.createdBy?c.createdBy.userName:"No User",updatedBy:c.updatedBy?c.updatedBy.userName:"No User"}));j(r)}else j([])}catch(t){console.error("Error fetching data:",t)}};n.useEffect(()=>{L()},[$]);const J=()=>{const t={};return i.successstoryName.trim()||(t.successstoryName="Enter the News"),i.description.trim()||(t.description="Enter the Description"),(!i.photoName||i.photoName.trim()==="")&&(t.photoName="Select the file"),t},B=t=>{p({...i,[t.target.name]:t.target.value}),w(a=>({...a,[t.target.name]:null}))},V=async t=>{try{await ye(t,m),P(a=>!a)}catch(a){console.error("Error deleting news:",a)}},q=async t=>{b(!0),h(!0);try{const r=(await fe(t,m)).data;z(r.successstoryId),p({successstoryName:r.successstoryName,description:r.description,photoName:r.photoName})}catch(a){console.error("Error fetching news by ID:",a)}},K=async t=>{if(t.preventDefault(),!I){C("Please select a file");return}const a=new FormData;a.append("file",I);try{const r=await u.post("https://executivetracking.cloudjiffy.net/Mahaasabha/file/uploadFile",a,{headers:{"content-type":"multipart/form-data",Authorization:`Bearer ${g.accessToken}`}});v(r.data.fileName),p(c=>({...c,photoName:r.data.fileName})),C(""),alert(r.data.message),console.log(r.data)}catch(r){console.error("Error uploading file:",r)}},Q=t=>{v(t.target.files[0].name),O(t.target.files[0])},X=async t=>{t.preventDefault();const a=J();if(console.log(i),Object.keys(a).length>0)w(a);else try{if(N){const r={...i,successstoryId:R,updatedBy:{userId:g.userId}};await ge(r,m)}else{const r={...i,createdBy:{userId:g.userId}};await xe(r,m)}p({successstoryName:"",description:"",photoName:""}),D.current.value=null,P(r=>!r),h(!1)}catch(r){console.error("Error saving news:",r)}},Y=()=>{b(!1),p({successstoryName:"",description:"",photoName:""}),h(!0)};return e.jsxs(ee,{title:e.jsxs(k,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:"SuccessStory"}),e.jsxs(y,{variant:"contained",color:"primary",sx:{display:"flex",alignItems:"center",fontSize:"15px"},onClick:Y,children:["Add",e.jsx(ae,{sx:{color:"#fff"}})]})]}),children:[e.jsx(f,{container:!0,spacing:te}),e.jsxs(se,{sx:{width:"100%",overflow:"hidden"},children:[e.jsx(ce,{sx:{maxHeight:440},children:e.jsxs(ne,{stickyHeader:!0,"aria-label":"sticky table",children:[e.jsx(ie,{children:e.jsx(M,{children:A.map(t=>e.jsx(F,{align:t.align,style:{minWidth:t.minWidth,fontWeight:600,fontSize:15},children:t.label},t.id))})}),e.jsx(le,{children:S.slice(o*s,o*s+s).map(t=>e.jsx(M,{hover:!0,role:"checkbox",tabIndex:-1,children:A.map(a=>e.jsx(F,{align:a.align,children:a.id==="actions"?e.jsxs(e.Fragment,{children:[e.jsx(T,{onClick:()=>q(t.successstoryId),color:"primary",children:e.jsx(re,{})}),e.jsx(T,{onClick:()=>V(t.successstoryId),color:"error",children:e.jsx(oe,{})})]}):t[a.id]},a.id))},t.successstoryId))})]})}),e.jsx(de,{rowsPerPageOptions:[10,25,100],component:"div",count:S.length,rowsPerPage:s,page:o,onPageChange:G,onRowsPerPageChange:H})]}),e.jsxs(ue,{open:W,onClose:()=>h(!1),fullWidth:!0,maxWidth:"md",children:[e.jsx(he,{sx:{fontSize:"16px"},children:N?"Edit SuccessStory":"Add SuccessStory"}),e.jsxs(k,{component:"form",onSubmit:X,noValidate:!0,sx:{p:3},children:[e.jsxs(f,{container:!0,spacing:2,children:[e.jsx(f,{item:!0,xs:12,children:e.jsx(x,{fullWidth:!0,label:"SuccessStory Name",name:"successstoryName",value:i.successstoryName,onChange:B,error:!!d.successstoryName,helperText:d.successstoryName})}),e.jsx(f,{item:!0,xs:12,children:e.jsx(x,{fullWidth:!0,label:"Description",name:"description",value:i.description,onChange:B,error:!!d.description,helperText:d.description,multiline:!0,rows:3})}),e.jsxs(f,{item:!0,xs:12,children:[e.jsx(x,{margin:"normal",fullWidth:!0,id:"photoName",label:"File Name",name:"photoName",autoComplete:"photoName",value:i.photoName,disabled:!0,helperText:d.photoName,error:!!d.photoName,InputProps:{endAdornment:e.jsx(y,{variant:"contained",color:"primary",onClick:K,children:"Upload"})}}),e.jsx("input",{type:"file",onChange:Q,ref:D,style:{marginTop:20}})]})]}),e.jsxs(pe,{children:[e.jsx(y,{onClick:()=>h(!1),children:"Cancel"}),e.jsx(y,{type:"submit",variant:"contained",color:"primary",children:"Save"})]})]})]})]})};export{Te as default};
