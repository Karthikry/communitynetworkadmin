import{r as d,j as t,b as R,a as T,I as w,T as S}from"./index-BoyrWkQt.js";import{d as z}from"./Edit-2SSNZ3I4.js";import{d as J}from"./Delete-BTlMcuVb.js";import{T as H,a as L,b as U,c as f,d as p,e as _,f as G}from"./TableRow-BWgOi_6U.js";import{D as Y,a as q,b as K}from"./DialogTitle-D-tDGQQo.js";import{D as Q}from"./DialogContent-DiWyJfmb.js";const x=[{id:"promTypeId",label:"Promo Type ID",minWidth:120},{id:"promTypeName",label:"Promo Type Name",minWidth:180},{id:"description",label:"Description",minWidth:200},{id:"createdBy",label:"Created By",minWidth:150},{id:"updatedBy",label:"Updated By",minWidth:150},{id:"insertedDate",label:"Inserted Date",minWidth:180},{id:"updatedDate",label:"Updated Date",minWidth:180},{id:"edit",label:"Edit",minWidth:80},{id:"delete",label:"Delete",minWidth:80}],ae=()=>{const[c,b]=d.useState(0),[l,C]=d.useState(10),[j,v]=d.useState([]),[k,I]=d.useState(0),[N,m]=d.useState(null),[E,P]=d.useState(!1),[g,B]=d.useState("add"),[n,h]=d.useState({promTypeId:0,promTypeName:"",description:""});d.useEffect(()=>{y()},[c,l]);const y=async()=>{try{const e=JSON.parse(sessionStorage.getItem("user")),o=(e==null?void 0:e.accessToken)||"",a=await fetch(`https://executivetracking.cloudjiffy.net/Mahaasabha/promotype/v1/getAllPromoTypeByPagination/{pageNumber}/{pageSize}?pageNumber=${c}&pageSize=${l}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`}});if(!a.ok)throw new Error(`Error: ${a.statusText}`);const r=await a.json(),i=r.content.map(s=>({promTypeId:s.promTypeId,promTypeName:s.promTypeName,description:s.description,createdBy:s.createdBy.fullName||s.createdBy.userName,updatedBy:s.updatedBy.fullName||s.updatedBy.userName,insertedDate:new Date(s.insertedDate).toLocaleDateString(),updatedDate:new Date(s.updatedDate).toLocaleDateString()}));v(i),I(r.totalElements)}catch(e){m(e.message),console.error("Failed to fetch promo types:",e)}},W=(e,o)=>{b(o)},A=e=>{C(+e.target.value),b(0)},D=(e,o={})=>{B(e),h(o),P(!0)},u=()=>{P(!1),h({promTypeId:0,promTypeName:"",description:""})},O=async()=>{g==="add"?await $():await F()},$=async()=>{try{const e=JSON.parse(sessionStorage.getItem("user")),o=(e==null?void 0:e.accessToken)||"",a={promTypeName:n.promTypeName,description:n.description,createdBy:{fullName:e.fullName||e.userName,mobileNumber:e.mobileNumber,userId:e.userId,userName:e.userName}},r=await fetch("https://executivetracking.cloudjiffy.net/Mahaasabha/promotype/v1/createPromoType",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(a)});if(!r.ok){const i=await r.json();throw console.error("Failed to add promo type:",i),new Error(`Error: ${r.statusText}`)}y(),u()}catch(e){m(e.message),console.error("Failed to add promo type:",e)}},F=async()=>{try{const e=JSON.parse(sessionStorage.getItem("user")),o=(e==null?void 0:e.accessToken)||"",a={promTypeId:n.promTypeId,promTypeName:n.promTypeName,description:n.description,updatedBy:{fullName:e.fullName||e.userName,mobileNumber:e.mobileNumber,userId:e.userId,userName:e.userName}},r=await fetch("https://executivetracking.cloudjiffy.net/Mahaasabha/promotype/v1/updatePromoType",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(a)});if(!r.ok){const i=await r.json();throw console.error("Failed to edit promo type:",i),new Error(`Error: ${r.statusText}`)}y(),u()}catch(e){m(e.message),console.error("Failed to edit promo type:",e)}},M=async e=>{if(window.confirm("Are you sure you want to delete this promo type?"))try{const a=JSON.parse(sessionStorage.getItem("user")),r=(a==null?void 0:a.accessToken)||"",i=await fetch(`https://executivetracking.cloudjiffy.net/Mahaasabha/promotype/v1/deletePromoTypeById/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`}});if(!i.ok){const s=await i.json();throw console.error("Failed to delete promo type:",s),new Error(`Error: ${i.statusText}`)}y()}catch(a){m(a.message),console.error("Failed to delete promo type:",a)}};return t.jsxs(R,{sx:{width:"100%",overflow:"hidden",mt:5},children:[t.jsx(T,{variant:"contained",sx:{margin:"10px"},onClick:()=>D("add"),children:"+ ADD PROMO TYPE"}),N&&t.jsxs("div",{style:{color:"red",textAlign:"center"},children:["Error: ",N]}),t.jsx(H,{sx:{maxHeight:440},children:t.jsxs(L,{stickyHeader:!0,"aria-label":"sticky table",children:[t.jsx(U,{children:t.jsx(f,{children:x.map(e=>t.jsx(p,{align:e.align||"left",style:{minWidth:e.minWidth,fontWeight:"bold"},children:e.label},e.id))})}),t.jsx(_,{children:j.length>0?j.slice(c*l,c*l+l).map(e=>t.jsx(f,{hover:!0,role:"checkbox",tabIndex:-1,children:x.map(o=>{const a=e[o.id];return o.id==="edit"?t.jsx(p,{align:"left",children:t.jsx(w,{onClick:()=>D("edit",e),color:"primary",children:t.jsx(z,{})})},o.id):o.id==="delete"?t.jsx(p,{align:"left",children:t.jsx(w,{onClick:()=>M(e.promTypeId),color:"secondary",children:t.jsx(J,{})})},o.id):t.jsx(p,{align:o.align||"left",children:a||"Not Available"},o.id)})},e.promTypeId)):t.jsx(f,{children:t.jsx(p,{colSpan:x.length,align:"center",sx:{padding:20},children:"No rows"})})})]})}),t.jsx(G,{rowsPerPageOptions:[10,25,100],component:"div",count:k,rowsPerPage:l,page:c,onPageChange:W,onRowsPerPageChange:A}),t.jsxs(Y,{open:E,onClose:u,children:[t.jsx(q,{children:g==="add"?"Add Promo Type":"Edit Promo Type"}),t.jsxs(Q,{children:[t.jsx(S,{autoFocus:!0,margin:"dense",label:"Promo Type Name",type:"text",fullWidth:!0,variant:"outlined",value:n.promTypeName,onChange:e=>h({...n,promTypeName:e.target.value})}),t.jsx(S,{margin:"dense",label:"Description",type:"text",fullWidth:!0,variant:"outlined",value:n.description,onChange:e=>h({...n,description:e.target.value})})]}),t.jsxs(K,{children:[t.jsx(T,{onClick:u,color:"primary",children:"Cancel"}),t.jsx(T,{onClick:O,color:"primary",children:g==="add"?"Add":"Save"})]})]})]})};export{ae as default};
