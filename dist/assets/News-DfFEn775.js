import{a as h,u as Z,r as i,j as e,M as ee,b as w,G as f,g as te,c as ae,I as T,T as x}from"./index-Djsfy_Oq.js";import{h as E}from"./moment-G82_0lEo.js";import{d as se}from"./Add-D7Eq1Nxw.js";import{d as re}from"./Edit-CWCknw8m.js";import{d as ne}from"./DeleteForever-DYpYIOBT.js";import{B as k}from"./Box-DEFhJFtP.js";import{T as oe,a as ie,b as le,c as M,d as F,e as de,f as ce}from"./TableRow-DpUlrRrC.js";import{D as he,a as ue}from"./DialogTitle-s7brXHWk.js";import{D as pe}from"./DialogActions-hyJVfphP.js";const me=async(n,d)=>{try{return await h({method:"POST",url:"https://executivetracking.cloudjiffy.net/Mahaasabha/news/v1/createNews",headers:d,data:n}).then(function(a){a.data.responseCode===201?alert("Advertisement  added successfully"):a.data.responseCode===400&&alert(a.data.errorMessage)})}catch(a){alert(a)}},fe=async n=>await h({method:"get",url:"https://executivetracking.cloudjiffy.net/Mahaasabha/news/v1/getAllNewsByPagination/{pageNumber}/{pageSize}?pageNumber=0&pageSize=10",headers:n}),ge=async(n,d)=>await h({method:"GET",url:`https://executivetracking.cloudjiffy.net/Mahaasabha/news/v1/getNewsById/{newsId}?newsId=${n}`,headers:d}),we=async(n,d)=>(console.log(n),await h({method:"PUT",url:"https://executivetracking.cloudjiffy.net/Mahaasabha/news/v1/updateNews",headers:d,data:n}).then(function(a){a.data.responseCode===201?alert(a.data.message):a.data.responseCode===400&&alert(a.data.errorMessage)}).catch(function(a){console.log(a)})),xe=async(n,d)=>await h({method:"delete",url:`https://executivetracking.cloudjiffy.net/Mahaasabha/news/v1/deleteNewsById/${n}`,headers:d}).then(a=>{a.data.responseCode===200?alert(a.data.message):a.data.responseCode===400&&alert(a.data.errorMessage)}).catch(a=>{console.log(a)}),A=[{id:"newsId",label:"ID"},{id:"newsName",label:"Name",minWidth:100},{id:"description",label:"Description",minWidth:100},{id:"file",label:"File"},{id:"createdBy",label:"Created By",align:"right"},{id:"updatedBy",label:"Updated By",align:"right"},{id:"insertedDate",label:"Inserted Date",align:"right"},{id:"updatedDate",label:"Updated Date",align:"right"},{id:"actions",label:"Actions",align:"right"}],Te=()=>{Z();const[n,d]=i.useState(0),[a,U]=i.useState(10),[N,y]=i.useState([]),[j,b]=i.useState(!1),[W,u]=i.useState(!1),[R,z]=i.useState(null),[Ne,v]=i.useState(""),[c,I]=i.useState({}),[D,O]=i.useState(null),C=i.useRef(null),[ye,S]=i.useState(""),[$,P]=i.useState(!1),[l,p]=i.useState({newsName:"",description:""}),G=(t,s)=>{d(s)},H=t=>{U(+t.target.value),d(0)},g=JSON.parse(sessionStorage.getItem("user")),m={"Content-type":"application/json",Authorization:`Bearer ${g.accessToken}`},_="https://executivetracking.cloudjiffy.net/Mahaasabha/file/downloadFile/?filePath=",L=async()=>{try{const s=(await fe(m)).data.content;if(s){const r=s.map(o=>({newsId:o.newsId,newsName:o.newsName,description:o.description,file:o.photoPath?e.jsx("img",{src:_+o.photoPath,alt:o.photoName,style:{width:100,height:50}}):"NO IMAGE FOUND",insertedDate:E(o.insertedDate).format("L"),updatedDate:E(o.updatedDate).format("L"),createdBy:o.createdBy?o.createdBy.userName:"No User",updatedBy:o.updatedBy?o.updatedBy.userName:"No User"}));y(r)}else y([])}catch(t){console.error("Error fetching data:",t)}};i.useEffect(()=>{L()},[$]);const J=()=>{const t={};return l.newsName.trim()||(t.newsName="Enter the News"),l.description.trim()||(t.description="Enter the Description"),(!l.photoName||l.photoName.trim()==="")&&(t.photoName="Select the file"),t},B=t=>{p({...l,[t.target.name]:t.target.value}),I(s=>({...s,[t.target.name]:null}))},V=async t=>{try{await xe(t,m),P(s=>!s)}catch(s){console.error("Error deleting news:",s)}},q=async t=>{b(!0),u(!0);try{const r=(await ge(t,m)).data;z(r.newsId),p({newsName:r.newsName,description:r.description,photoName:r.photoName})}catch(s){console.error("Error fetching news by ID:",s)}},K=async t=>{if(t.preventDefault(),!D){S("Please select a file");return}const s=new FormData;s.append("file",D);try{const r=await h.post("https://executivetracking.cloudjiffy.net/Mahaasabha/file/uploadFile",s,{headers:{"content-type":"multipart/form-data",Authorization:`Bearer ${g.accessToken}`}});v(r.data.fileName),p(o=>({...o,photoName:r.data.fileName})),S(""),alert(r.data.message),console.log(r.data)}catch(r){console.error("Error uploading file:",r)}},Q=t=>{v(t.target.files[0].name),O(t.target.files[0])},X=async t=>{t.preventDefault();const s=J();if(console.log(l),Object.keys(s).length>0)I(s);else try{if(j){const r={...l,newsId:R,updatedBy:{userId:g.userId}};await we(r,m)}else{const r={...l,createdBy:{userId:g.userId}};await me(r,m)}p({newsName:"",description:"",photoName:""}),C.current.value=null,P(r=>!r),u(!1)}catch(r){console.error("Error saving news:",r)}},Y=()=>{b(!1),p({newsName:"",description:"",photoName:""}),u(!0)};return e.jsxs(ee,{title:e.jsxs(k,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:"News"}),e.jsxs(w,{variant:"contained",color:"primary",sx:{display:"flex",alignItems:"center",fontSize:"15px"},onClick:Y,children:["Add",e.jsx(se,{sx:{color:"#fff"}})]})]}),children:[e.jsx(f,{container:!0,spacing:te}),e.jsxs(ae,{sx:{width:"100%",overflow:"hidden"},children:[e.jsx(oe,{sx:{maxHeight:440},children:e.jsxs(ie,{stickyHeader:!0,"aria-label":"sticky table",children:[e.jsx(le,{children:e.jsx(M,{children:A.map(t=>e.jsx(F,{align:t.align,style:{minWidth:t.minWidth,fontWeight:600,fontSize:15},children:t.label},t.id))})}),e.jsx(de,{children:N.slice(n*a,n*a+a).map(t=>e.jsx(M,{hover:!0,role:"checkbox",tabIndex:-1,children:A.map(s=>e.jsx(F,{align:s.align,children:s.id==="actions"?e.jsxs(e.Fragment,{children:[e.jsx(T,{onClick:()=>q(t.newsId),color:"primary",children:e.jsx(re,{})}),e.jsx(T,{onClick:()=>V(t.newsId),color:"error",children:e.jsx(ne,{})})]}):t[s.id]},s.id))},t.newsId))})]})}),e.jsx(ce,{rowsPerPageOptions:[10,25,100],component:"div",count:N.length,rowsPerPage:a,page:n,onPageChange:G,onRowsPerPageChange:H})]}),e.jsxs(he,{open:W,onClose:()=>u(!1),fullWidth:!0,maxWidth:"md",children:[e.jsx(ue,{sx:{fontSize:"16px"},children:j?"Edit News":"Add News"}),e.jsxs(k,{component:"form",onSubmit:X,noValidate:!0,sx:{p:3},children:[e.jsxs(f,{container:!0,spacing:2,children:[e.jsx(f,{item:!0,xs:12,children:e.jsx(x,{fullWidth:!0,label:"News Name",name:"newsName",value:l.newsName,onChange:B,error:!!c.newsName,helperText:c.newsName})}),e.jsx(f,{item:!0,xs:12,children:e.jsx(x,{fullWidth:!0,label:"Description",name:"description",value:l.description,onChange:B,error:!!c.description,helperText:c.description,multiline:!0,rows:3})}),e.jsxs(f,{item:!0,xs:12,children:[e.jsx(x,{margin:"normal",fullWidth:!0,id:"photoName",label:"File Name",name:"photoName",autoComplete:"photoName",value:l.photoName,disabled:!0,helperText:c.photoName,error:!!c.photoName,InputProps:{endAdornment:e.jsx(w,{variant:"contained",color:"primary",onClick:K,children:"Upload"})}}),e.jsx("input",{type:"file",onChange:Q,ref:C,style:{marginTop:20}})]})]}),e.jsxs(pe,{children:[e.jsx(w,{onClick:()=>u(!1),children:"Cancel"}),e.jsx(w,{type:"submit",variant:"contained",color:"primary",children:"Save"})]})]})]})]})};export{Te as default};
