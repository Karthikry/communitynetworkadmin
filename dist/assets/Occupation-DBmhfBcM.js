import{r,j as a,b as J,a as f,I as C,T as O}from"./index-BoyrWkQt.js";import{d as M}from"./Edit-2SSNZ3I4.js";import{d as R}from"./Delete-BTlMcuVb.js";import{T as U,a as H,b as L,c as x,d as y,e as _,f as G}from"./TableRow-BWgOi_6U.js";import{D as q,a as K,b as Q}from"./DialogTitle-D-tDGQQo.js";import{D as V}from"./DialogContent-DiWyJfmb.js";const b=[{id:"occupationId",label:"ID",minWidth:50},{id:"occupationName",label:"Occupation Name",minWidth:150},{id:"description",label:"Description",minWidth:200},{id:"createdBy",label:"Created By",minWidth:150},{id:"updatedBy",label:"Updated By",minWidth:150},{id:"insertedDate",label:"Inserted Date",minWidth:180},{id:"updatedDate",label:"Updated Date",minWidth:180},{id:"actions",label:"Actions",minWidth:100,align:"center"}],oe=()=>{const[h,N]=r.useState(0),[m,S]=r.useState(10),[j,v]=r.useState([]),[k,I]=r.useState(0),[D,d]=r.useState(null),[B,T]=r.useState(!1),[g,E]=r.useState("add"),[i,l]=r.useState({occupationId:0,occupationName:"",description:""});r.useEffect(()=>{u()},[h,m]);const u=async()=>{try{const e=JSON.parse(sessionStorage.getItem("user")),o=(e==null?void 0:e.accessToken)||"",t=await fetch(`https://executivetracking.cloudjiffy.net/Mahaasabha/gotra/v1/getAllOccupationByPagination/{pageNumber}/{pageSize}?pageNumber=${h}&pageSize=${m}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`}});if(!t.ok)throw new Error(`Error: ${t.statusText}`);const n=await t.json(),c=n.content.map(s=>({occupationId:s.occupationId,occupationName:s.occupationName,description:s.description,createdBy:s.createdBy.fullName||s.createdBy.userName,updatedBy:s.updatedBy.fullName||s.updatedBy.userName,insertedDate:new Date(s.insertedDate).toLocaleDateString(),updatedDate:new Date(s.updatedDate).toLocaleDateString()}));v(c),I(n.totalElements)}catch(e){d(e.message),console.error("Failed to fetch occupations:",e)}},P=(e,o)=>{N(o)},A=e=>{S(+e.target.value),N(0)},w=(e,o={})=>{E(e),l(o),T(!0)},p=()=>{T(!1),l({occupationId:0,occupationName:"",description:""})},W=async()=>{g==="add"?await $():await F()},$=async()=>{try{const e=JSON.parse(sessionStorage.getItem("user")||"{}"),o=(e==null?void 0:e.accessToken)||"",t={occupationName:i.occupationName,description:i.description,createdBy:{fullName:e.fullName||e.userName,mobileNumber:e.mobileNumber,userId:e.userId,userName:e.userName}},n=await fetch("https://executivetracking.cloudjiffy.net/Mahaasabha/gotra/v1/createOccupation",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(t)});if(!n.ok){const c=await n.json();throw console.error("Failed to add occupation:",c),new Error(`Error: ${n.statusText}`)}u(),p()}catch(e){d(e.message),console.error("Failed to add occupation:",e)}},F=async()=>{try{const e=JSON.parse(sessionStorage.getItem("user")||"{}"),o=(e==null?void 0:e.accessToken)||"",t={occupationId:i.occupationId,occupationName:i.occupationName,description:i.description,updatedBy:{fullName:e.fullName||e.userName,mobileNumber:e.mobileNumber,userId:e.userId,userName:e.userName}},n=await fetch("https://executivetracking.cloudjiffy.net/Mahaasabha/gotra/v1/updateOccupation",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify(t)});if(!n.ok){const c=await n.json();throw console.error("Failed to edit occupation:",c),new Error(`Error: ${n.statusText}`)}u(),p()}catch(e){d(e.message),console.error("Failed to edit occupation:",e)}},z=async e=>{if(window.confirm("Are you sure you want to delete this occupation?"))try{const t=JSON.parse(sessionStorage.getItem("user")||"{}"),n=(t==null?void 0:t.accessToken)||"",c=await fetch(`https://executivetracking.cloudjiffy.net/Mahaasabha/gotra/v1/deleteOccupationById/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}});if(!c.ok){const s=await c.json();throw console.error("Failed to delete occupation:",s),new Error(`Error: ${c.statusText}`)}u()}catch(t){d(t.message),console.error("Failed to delete occupation:",t)}};return a.jsxs(J,{sx:{width:"100%",overflow:"hidden",mt:5},children:[a.jsx(f,{variant:"contained",sx:{margin:"10px"},onClick:()=>w("add"),children:"+ ADD OCCUPATION"}),D&&a.jsxs("div",{style:{color:"red",textAlign:"center"},children:["Error: ",D]}),a.jsx(U,{sx:{maxHeight:440},children:a.jsxs(H,{stickyHeader:!0,"aria-label":"sticky table",children:[a.jsx(L,{children:a.jsx(x,{children:b.map(e=>a.jsx(y,{align:e.align||"left",style:{minWidth:e.minWidth,fontWeight:"bold"},children:e.label},e.id))})}),a.jsx(_,{children:j.length>0?j.map(e=>a.jsx(x,{hover:!0,role:"checkbox",tabIndex:-1,children:b.map(o=>{const t=e[o.id];return a.jsx(y,{align:o.align||"left",children:o.id==="actions"?a.jsxs(a.Fragment,{children:[a.jsx(C,{onClick:()=>w("edit",e),color:"primary",children:a.jsx(M,{})}),a.jsx(C,{onClick:()=>z(e.occupationId),color:"secondary",children:a.jsx(R,{})})]}):t||"Not Available"},o.id)})},e.occupationId)):a.jsx(x,{children:a.jsx(y,{colSpan:b.length,align:"center",sx:{padding:20},children:"No rows"})})})]})}),a.jsx(G,{rowsPerPageOptions:[10,25,100],component:"div",count:k,rowsPerPage:m,page:h,onPageChange:P,onRowsPerPageChange:A}),a.jsxs(q,{open:B,onClose:p,children:[a.jsx(K,{children:g==="add"?"Add Occupation":"Edit Occupation"}),a.jsxs(V,{children:[a.jsx(O,{autoFocus:!0,margin:"dense",label:"Occupation Name",fullWidth:!0,variant:"outlined",value:i.occupationName,onChange:e=>l({...i,occupationName:e.target.value})}),a.jsx(O,{margin:"dense",label:"Description",fullWidth:!0,variant:"outlined",value:i.description,onChange:e=>l({...i,description:e.target.value})})]}),a.jsxs(Q,{children:[a.jsx(f,{onClick:p,children:"Cancel"}),a.jsx(f,{onClick:W,children:g==="add"?"Add":"Save"})]})]})]})};export{oe as default};
