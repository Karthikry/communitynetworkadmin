import{r as d,j as t,c as J,b as f,I as w,T as C}from"./index-BCMjTDj-.js";import{d as M}from"./Edit-BAFAy0Gz.js";import{d as R}from"./Delete-DQ5tIu97.js";import{T as H,a as L,b as U,c as x,d as y,e as _}from"./TableRow-C6k8ikuc.js";import{T as G}from"./TablePagination-au4wXnx7.js";import{D as q,a as K}from"./DialogTitle-D85XLa7F.js";import{D as Q}from"./DialogContent-B8Y-o2C7.js";import{D as V}from"./DialogActions-Db_kJuz6.js";import"./LastPage-aK0Jz_ev.js";const S=[{id:"stateId",label:"ID",minWidth:50},{id:"stateName",label:"State Name",minWidth:150},{id:"description",label:"Description",minWidth:200},{id:"createdBy",label:"Created By",minWidth:150},{id:"updatedBy",label:"Updated By",minWidth:150},{id:"insertedDate",label:"Inserted Date",minWidth:180},{id:"updatedDate",label:"Updated Date",minWidth:180},{id:"actions",label:"Actions",minWidth:100,align:"center"}],ne=()=>{const[p,j]=d.useState(0),[m,k]=d.useState(10),[b,I]=d.useState([]),[v,B]=d.useState(0),[N,c]=d.useState(null),[E,D]=d.useState(!1),[g,P]=d.useState("add"),[i,l]=d.useState({stateId:0,stateName:"",description:""});d.useEffect(()=>{h()},[p,m]);const h=async()=>{try{const e=JSON.parse(sessionStorage.getItem("user")),s=(e==null?void 0:e.accessToken)||"",a=await fetch(`https://executivetracking.cloudjiffy.net/Mahaasabha/state/v1/getAllStateByPagination/{pageNumber}/{pageSize}?pageNumber=${p}&pageSize=${m}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`}});if(!a.ok)throw new Error(`Error: ${a.statusText}`);const o=await a.json(),n=o.content.map(r=>({stateId:r.stateId,stateName:r.stateName,description:r.description,createdBy:r.createdBy.fullName||r.createdBy.userName,updatedBy:r.updatedBy.fullName||r.updatedBy.userName,insertedDate:new Date(r.insertedDate).toLocaleDateString(),updatedDate:new Date(r.updatedDate).toLocaleDateString()}));I(n),B(o.totalElements)}catch(e){c(e.message),console.error("Failed to fetch states:",e)}},A=(e,s)=>{j(s)},W=e=>{k(+e.target.value),j(0)},T=(e,s={})=>{P(e),l(s),D(!0)},u=()=>{D(!1),l({stateId:0,stateName:"",description:""})},$=async()=>{g==="add"?await F():await O()},F=async()=>{try{const e=JSON.parse(sessionStorage.getItem("user")||"{}"),s=(e==null?void 0:e.accessToken)||"",a={stateName:i.stateName,description:i.description,createdBy:{fullName:e.fullName||e.userName,mobileNumber:e.mobileNumber,userId:e.userId,userName:e.userName}},o=await fetch("https://executivetracking.cloudjiffy.net/Mahaasabha/state/v1/createState",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(a)});if(!o.ok){const n=await o.json();throw console.error("Failed to add state:",n),new Error(`Error: ${o.statusText}`)}h(),u()}catch(e){c(e.message),console.error("Failed to add state:",e)}},O=async()=>{try{const e=JSON.parse(sessionStorage.getItem("user")||"{}"),s=(e==null?void 0:e.accessToken)||"",a={stateId:i.stateId,stateName:i.stateName,description:i.description,updatedBy:{fullName:e.fullName||e.userName,mobileNumber:e.mobileNumber,userId:e.userId,userName:e.userName}},o=await fetch("https://executivetracking.cloudjiffy.net/Mahaasabha/state/v1/updateState",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(a)});if(!o.ok){const n=await o.json();throw console.error("Failed to edit state:",n),new Error(`Error: ${o.statusText}`)}h(),u()}catch(e){c(e.message),console.error("Failed to edit state:",e)}},z=async e=>{if(window.confirm("Are you sure you want to delete this city?"))try{const a=JSON.parse(sessionStorage.getItem("user")||"{}"),o=(a==null?void 0:a.accessToken)||"";console.log("Deleting city with ID:",e);const n=await fetch(`https://executivetracking.cloudjiffy.net/Mahaasabha/state/v1/deleteStateById/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`}});if(!n.ok){const r=await n.json();throw console.error("Failed to delete city:",r),new Error(`Error: ${n.statusText}`)}console.log("Delete successful:",await n.json()),h()}catch(a){c(a.message),console.error("Failed to delete city:",a)}};return t.jsxs(J,{sx:{width:"100%",overflow:"hidden",mt:5},children:[t.jsx(f,{variant:"contained",sx:{margin:"10px"},onClick:()=>T("add"),children:"+ ADD STATE"}),N&&t.jsxs("div",{style:{color:"red",textAlign:"center"},children:["Error: ",N]}),t.jsx(H,{sx:{maxHeight:440},children:t.jsxs(L,{stickyHeader:!0,"aria-label":"sticky table",children:[t.jsx(U,{children:t.jsx(x,{children:S.map(e=>t.jsx(y,{align:e.align||"left",style:{minWidth:e.minWidth,fontWeight:"bold"},children:e.label},e.id))})}),t.jsx(_,{children:b.length>0?b.map(e=>t.jsx(x,{hover:!0,role:"checkbox",tabIndex:-1,children:S.map(s=>{const a=e[s.id];return t.jsx(y,{align:s.align||"left",children:s.id==="actions"?t.jsxs(t.Fragment,{children:[t.jsx(w,{onClick:()=>T("edit",e),color:"primary",children:t.jsx(M,{})}),t.jsx(w,{onClick:()=>z(e.stateId),color:"secondary",children:t.jsx(R,{})})]}):a},s.id)})},e.stateId)):t.jsx(x,{children:t.jsx(y,{colSpan:S.length,align:"center",children:"No records found."})})})]})}),t.jsx(G,{rowsPerPageOptions:[10,25,50,100],component:"div",count:v,rowsPerPage:m,page:p,onPageChange:A,onRowsPerPageChange:W}),t.jsxs(q,{open:E,onClose:u,children:[t.jsx(K,{children:g==="add"?"Add State":"Edit State"}),t.jsxs(Q,{children:[t.jsx(C,{autoFocus:!0,margin:"dense",id:"stateName",label:"State Name",fullWidth:!0,value:i.stateName,onChange:e=>l({...i,stateName:e.target.value})}),t.jsx(C,{margin:"dense",id:"description",label:"Description",fullWidth:!0,value:i.description,onChange:e=>l({...i,description:e.target.value})})]}),t.jsxs(V,{children:[t.jsx(f,{onClick:u,children:"Cancel"}),t.jsx(f,{onClick:$,variant:"contained",children:g==="add"?"Add":"Save"})]})]})]})};export{ne as default};
