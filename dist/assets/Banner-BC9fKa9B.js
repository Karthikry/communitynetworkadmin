import{u as te,r as s,j as e,M as ae,B as W,b as g,G as u,g as re,c as se,I as R,T as N,a as U}from"./index-BCMjTDj-.js";import{f as ie,u as ne,a as le,g as de,d as oe}from"./BannerApi-C304SyL-.js";import{h as M}from"./moment-G82_0lEo.js";import{d as ce}from"./Add-ARitWxv6.js";import{T as me,a as ue,b as fe,c as z,d as b,e as he}from"./TableRow-C6k8ikuc.js";import{E as pe,D as ge}from"./Edit-Bd8MNGzJ.js";import{T as xe}from"./TablePagination-au4wXnx7.js";import{D as ve,a as je}from"./DialogTitle-D85XLa7F.js";import{D as ye}from"./DialogActions-Db_kJuz6.js";import"./LastPage-aK0Jz_ev.js";const O=[{id:"advertisementId",label:"ID"},{id:"advertisementName",label:"Name",minWidth:100},{id:"description",label:"Description",minWidth:100},{id:"file",label:"File"},{id:"createdBy",label:"Created By",align:"right"},{id:"updatedBy",label:"Updated By",align:"right"},{id:"insertedDate",label:"Inserted Date",align:"right"},{id:"updatedDate",label:"Updated Date",align:"right"},{id:"actions",label:"Actions",align:"right"}],Pe=()=>{te();const[x,D]=s.useState(0),[f,H]=s.useState(10),[B,I]=s.useState([]),[G,l]=s.useState(!1),[h,T]=s.useState(!1),[n,d]=s.useState({advertisementName:"",description:"",fileName:""}),[o,C]=s.useState({}),[E,v]=s.useState(""),[S,j]=s.useState(""),[p,F]=s.useState(null),[$,L]=s.useState(!1),[J,V]=s.useState(null),P=s.useRef(null),c=JSON.parse(sessionStorage.getItem("user")),y=(c==null?void 0:c.accessToken)||"",m={"Content-type":"application/json",Authorization:`Bearer ${y}`},_="https://executivetracking.cloudjiffy.net/Mahaasabha/file/downloadFile/?filePath=",w=async()=>{try{const a=(await ie(m)).data.content;if(a){const r=a.map(i=>({advertisementId:i.advertisementId,advertisementName:i.advertisementName,description:i.description,file:i.filePath===null?"NO IMAGE FOUND":e.jsx("img",{src:_+i.filePath,alt:i.fileName,style:{width:100,height:50}}),insertedDate:M(i.insertedDate).format("L"),updatedDate:M(i.updatedDate).format("L"),createdBy:i.createdBy?i.createdBy.userName:"No User",updatedBy:i.updatedBy?i.updatedBy.userName:"No User"}));I(r)}else I([])}catch(t){console.error("Error fetching data:",t)}};s.useEffect(()=>{w()},[$]);const q=async t=>{if(t.preventDefault(),!p){v("Please select a file");return}const a=new FormData;a.append("file",p);try{const r=await U.post("https://executivetracking.cloudjiffy.net/Mahaasabha/file/uploadFile",a,{headers:{"content-type":"multipart/form-data",Authorization:`Bearer ${y}`}});j(r.data.fileName),d({...n,fileName:r.data.fileName}),v(""),alert("File uploaded successfully")}catch(r){console.error("Error uploading file:",r)}},K=async t=>{t.preventDefault();const a=X();if(Object.keys(a).length>0){C(a);return}try{if(p&&!h){const r=new FormData;r.append("file",p);const k=(await U.post("https://executivetracking.cloudjiffy.net/Mahaasabha/file/uploadFile",r,{headers:{"Content-Type":"multipart/form-data",Authorization:`Bearer ${y}`}})).data.fileName;j(k),n.fileName=k}if(h){const r={...n,advertisementId:J,updatedBy:{userId:c.userId}};await ne(r,m)}else await le(n,m);d({advertisementName:"",description:"",fileName:""}),F(null),P.current.value=null,L(r=>!r),l(!1)}catch(r){console.error("Error saving advertisement:",r)}},Q=t=>{const a=t.target.files[0];a&&(j(a.name),F(a),v(""))},X=()=>{const t={};return(!n.advertisementName||n.advertisementName.trim()==="")&&(t.advertisementName="Enter the Advertisement name"),(!n.description||n.description.trim()==="")&&(t.description="Enter the description"),!S&&!h&&(t.fileName="Please upload a file"),t},A=t=>{d({...n,[t.target.name]:t.target.value,createdBy:{userId:c.userId}}),C({...o,[t.target.name]:null})},Y=()=>{T(!1),d({advertisementName:"",description:"",fileName:""}),l(!0)},Z=async t=>{T(!0),l(!0);try{const r=(await de(t,m)).data;V(r.advertisementId),d({advertisementName:r.advertisementName,description:r.description,fileName:r.fileName})}catch(a){console.error("Error fetching advertisement details:",a)}},ee=async t=>{try{await oe(t,m),w()}catch(a){console.error("Error deleting advertisement:",a)}};return e.jsxs(ae,{title:e.jsxs(W,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:"Banner"}),e.jsxs(g,{variant:"contained",color:"primary",sx:{display:"flex",alignItems:"center",fontSize:"15px"},onClick:Y,children:["Add",e.jsx(ce,{sx:{color:"#fff"}})]})]}),children:[e.jsx(u,{container:!0,spacing:re}),e.jsxs(se,{sx:{width:"100%",overflow:"hidden"},children:[e.jsx(me,{sx:{maxHeight:440},children:e.jsxs(ue,{stickyHeader:!0,"aria-label":"sticky table",children:[e.jsx(fe,{children:e.jsx(z,{children:O.map(t=>e.jsx(b,{align:t.align,style:{minWidth:t.minWidth,fontWeight:600,fontSize:15},children:t.label},t.id))})}),e.jsx(he,{children:B.slice(x*f,x*f+f).map(t=>e.jsxs(z,{hover:!0,role:"checkbox",tabIndex:-1,children:[O.map(a=>{const r=t[a.id];return e.jsx(b,{align:a.align,children:r},a.id)}),e.jsxs(b,{align:"right",children:[e.jsx(R,{onClick:()=>Z(t.advertisementId),children:e.jsx(pe,{})}),e.jsx(R,{onClick:()=>ee(t.advertisementId),children:e.jsx(ge,{})})]})]},t.advertisementId))})]})}),e.jsx(xe,{rowsPerPageOptions:[10,25,100],component:"div",count:B.length,rowsPerPage:f,page:x,onPageChange:(t,a)=>D(a),onRowsPerPageChange:t=>{H(+t.target.value),D(0)}})]}),e.jsxs(ve,{open:G,onClose:()=>l(!1),fullWidth:!0,maxWidth:"md",children:[e.jsx(je,{sx:{fontSize:"16px"},children:h?"Edit Advertisement":"Add Advertisement"}),e.jsxs(W,{component:"form",onSubmit:K,noValidate:!0,sx:{p:3},children:[e.jsxs(u,{container:!0,spacing:2,children:[e.jsx(u,{item:!0,xs:12,children:e.jsx(N,{fullWidth:!0,label:"Advertisement Name",name:"advertisementName",value:n.advertisementName,onChange:A,error:!!o.advertisementName,helperText:o.advertisementName})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(N,{fullWidth:!0,label:"Description",name:"description",value:n.description,onChange:A,error:!!o.description,helperText:o.description,multiline:!0,rows:3})}),e.jsxs(u,{item:!0,xs:12,children:[e.jsx(N,{margin:"normal",fullWidth:!0,id:"fileName",label:"File Name",name:"fileName",autoComplete:"fileName",value:S,disabled:!0,helperText:E||"Please upload a valid file",error:!!E,InputProps:{endAdornment:e.jsx(g,{variant:"contained",color:"primary",onClick:q,children:"Upload"})}}),e.jsx("input",{type:"file",onChange:Q,ref:P,style:{marginTop:20}})]})]}),e.jsxs(ye,{children:[e.jsx(g,{onClick:()=>l(!1),children:"Cancel"}),e.jsx(g,{type:"submit",variant:"contained",color:"primary",children:"Save"})]})]})]})]})};export{Pe as default};
