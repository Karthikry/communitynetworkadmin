import{u as Z,r as s,j as e,M as ee,B as E,b as u,G as m,g as te,c as ae,I as P,T as g,a as re,x as w}from"./index-BCMjTDj-.js";import{f as se,u as ie,a as ne,g as le,d as de}from"./BannerApi-C304SyL-.js";import{h as A}from"./moment-G82_0lEo.js";import{d as oe}from"./Add-ARitWxv6.js";import{T as ce,a as me,b as fe,c as F,d as k,e as he}from"./TableRow-C6k8ikuc.js";import{E as ue,D as pe}from"./Edit-Bd8MNGzJ.js";import{T as ge}from"./TablePagination-au4wXnx7.js";import{D as xe,a as ve}from"./DialogTitle-D85XLa7F.js";import{D as Ne}from"./DialogActions-Db_kJuz6.js";import"./LastPage-aK0Jz_ev.js";const U=[{id:"advertisementId",label:"ID"},{id:"advertisementName",label:"Topic",minWidth:100},{id:"description",label:"Title",minWidth:100},{id:"file",label:"Message"},{id:"createdBy",label:"Created By",align:"right"},{id:"insertedDate",label:"Inserted Date",align:"right"},{id:"updatedBy",label:"Updated By",align:"right"},{id:"updatedDate",label:"Updated Date",align:"right"},{id:"actions",label:"Actions",align:"right"}],Ae=()=>{Z();const[p,x]=s.useState(0),[f,W]=s.useState(10),[v,N]=s.useState([]),[R,d]=s.useState(!1),[j,y]=s.useState(!1),[i,o]=s.useState({advertisementName:"",description:"",fileName:""}),[l,b]=s.useState({}),[je,D]=s.useState(""),[ye,B]=s.useState(""),[I,M]=s.useState(null),[O,z]=s.useState(!1),[H,G]=s.useState(null),T=s.useRef(null),L=(t,a)=>{x(a)},$=t=>{W(+t.target.value),x(0)},h=JSON.parse(sessionStorage.getItem("user")),c={"Content-type":"application/json",Authorization:"Bearer "+h.accessToken},J=`${w}/file/downloadFile/?filePath=`,C=async()=>{try{const a=(await se(c)).data.content;if(a){const r=a.map(n=>({advertisementId:n.advertisementId,advertisementName:n.advertisementName,description:n.description,file:n.filePath===null?"NO IMAGE FOUND":e.jsx("img",{src:J+n.filePath,alt:n.fileName,style:{width:100,height:50}}),insertedDate:A(n.insertedDate).format("L"),updatedDate:A(n.updatedDate).format("L"),createdBy:n.createdBy?n.createdBy.userName:"No User",updatedBy:n.updatedBy?n.updatedBy.userName:"No User"}));N(r)}else N([])}catch(t){console.error("Error fetching data:",t)}};s.useEffect(()=>{C()},[O]);const V=async t=>{t.preventDefault();const a=K();if(Object.keys(a).length>0)b(a);else try{if(j){const r={...i,advertisementId:H,updatedBy:{userId:h.userId}};await ie(r,c)}else await ne(i,c);o({advertisementName:"",description:"",fileName:""}),T.current.value=null,z(r=>!r),d(!1)}catch(r){console.error("Error saving advertisement:",r)}},_=async t=>{if(t.preventDefault(),!I){D("Please select a file");return}const a=new FormData;a.append("file",I);try{const r=await re.post(`${w}/file/uploadFile`,a,{headers:{"content-type":"multipart/form-data",Authorization:"Bearer "+h.accessToken}});B(r.data.fileName),alert(r.data.message),o({...i,fileName:r.data.fileName}),D("")}catch(r){console.error("Error uploading file:",r)}},q=t=>{B(t.target.files[0].name),M(t.target.files[0])},K=()=>{const t={};return(!i.advertisementName||i.advertisementName.trim()==="")&&(t.advertisementName="Enter the Advertisement name"),(!i.description||i.description.trim()==="")&&(t.description="Enter the description"),(!i.fileName||i.fileName.trim()==="")&&(t.fileName="Select the file"),t},S=t=>{o({...i,[t.target.name]:t.target.value,createdBy:{userId:h.userId}}),b({...l,[t.target.name]:null})},Q=()=>{y(!1),o({advertisementName:"",description:"",fileName:""}),d(!0)},X=async t=>{y(!0),d(!0);try{const r=(await le(t,c)).data;G(r.advertisementId),o({advertisementName:r.advertisementName,description:r.description,fileName:r.fileName})}catch(a){console.error("Error fetching advertisement details:",a)}},Y=async t=>{try{await de(t,c),C()}catch(a){console.error("Error deleting advertisement:",a)}};return e.jsxs(ee,{title:e.jsxs(E,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:"Banner"}),e.jsxs(u,{variant:"contained",color:"primary",sx:{display:"flex",alignItems:"center",fontSize:"15px"},onClick:Q,children:["Add",e.jsx(oe,{sx:{color:"#fff"}})]})]}),children:[e.jsx(m,{container:!0,spacing:te}),e.jsxs(ae,{sx:{width:"100%",overflow:"hidden"},children:[e.jsx(ce,{sx:{maxHeight:440},children:e.jsxs(me,{stickyHeader:!0,"aria-label":"sticky table",children:[e.jsx(fe,{children:e.jsx(F,{children:U.map(t=>e.jsx(k,{align:t.align,style:{minWidth:t.minWidth,fontWeight:600,fontSize:15},children:t.label},t.id))})}),e.jsx(he,{children:v.slice(p*f,p*f+f).map(t=>e.jsx(F,{hover:!0,role:"checkbox",tabIndex:-1,children:U.map(a=>e.jsx(k,{align:a.align,children:a.id==="actions"?e.jsxs(e.Fragment,{children:[e.jsx(P,{onClick:()=>X(t.advertisementId),color:"primary",children:e.jsx(ue,{})}),e.jsx(P,{onClick:()=>Y(t.advertisementId),color:"error",children:e.jsx(pe,{})})]}):t[a.id]},a.id))},t.advertisementId))})]})}),e.jsx(ge,{rowsPerPageOptions:[10,25,100],component:"div",count:v.length,rowsPerPage:f,page:p,onPageChange:L,onRowsPerPageChange:$})]}),e.jsxs(xe,{open:R,onClose:()=>d(!1),fullWidth:!0,maxWidth:"md",children:[e.jsx(ve,{sx:{fontSize:"16px"},children:j?"Edit Advertisement":"Add Advertisement"}),e.jsxs(E,{component:"form",onSubmit:V,noValidate:!0,sx:{p:3},children:[e.jsxs(m,{container:!0,spacing:2,children:[e.jsx(m,{item:!0,xs:12,children:e.jsx(g,{fullWidth:!0,label:"Topic",name:"Topic",value:i.advertisementName,onChange:S,error:!!l.advertisementName,helperText:l.advertisementName})}),e.jsx(m,{item:!0,xs:12,children:e.jsx(g,{fullWidth:!0,label:"Description",name:"description",value:i.description,onChange:S,error:!!l.description,helperText:l.description,multiline:!0,rows:3})}),e.jsxs(m,{item:!0,xs:12,children:[e.jsx(g,{margin:"normal",fullWidth:!0,id:"fileName",label:"File Name",name:"fileName",autoComplete:"fileName",value:i.fileName,disabled:!0,helperText:l.fileName,error:!!l.fileName,InputProps:{endAdornment:e.jsx(u,{variant:"contained",color:"primary",onClick:_,children:"Upload"})}}),e.jsx("input",{type:"file",onChange:q,ref:T,style:{marginTop:20}})]})]}),e.jsxs(Ne,{children:[e.jsx(u,{onClick:()=>d(!1),children:"Cancel"}),e.jsx(u,{type:"submit",variant:"contained",color:"primary",children:"Save"})]})]})]})]})};export{Ae as default};
