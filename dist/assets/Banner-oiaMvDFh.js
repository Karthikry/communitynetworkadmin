import{u as Y,r,j as t,M as Z,B as w,a as f,G as ee,g as te,b as ae,I as A,T as P,c as se}from"./index-BoyrWkQt.js";import{f as re,u as ie,a as ne,g as de,d as le}from"./BannerApi-C_FYGU-u.js";import{h as k}from"./moment-G82_0lEo.js";import{d as oe}from"./Add-BxBLYjW4.js";import{T as ce,a as me,b as he,c as U,d as v,e as fe,f as ue}from"./TableRow-BWgOi_6U.js";import{E as pe,D as ge}from"./Edit-B96ZWXBo.js";import{D as xe,a as ve,b as je}from"./DialogTitle-D-tDGQQo.js";const W=[{id:"advertisementId",label:"ID"},{id:"advertisementName",label:"Name",minWidth:100},{id:"description",label:"Description",minWidth:100},{id:"file",label:"File"},{id:"createdBy",label:"Created By",align:"right"},{id:"updatedBy",label:"Updated By",align:"right"},{id:"insertedDate",label:"Inserted Date",align:"right"},{id:"updatedDate",label:"Updated Date",align:"right"},{id:"actions",label:"Actions",align:"right"}],Ee=()=>{Y();const[u,j]=r.useState(0),[h,M]=r.useState(10),[y,N]=r.useState([]),[R,d]=r.useState(!1),[p,b]=r.useState(!1),[n,l]=r.useState({advertisementName:"",description:"",fileName:""}),[o,D]=r.useState({}),[B,I]=r.useState(""),[g,S]=r.useState(""),[x,O]=r.useState(null),[z,H]=r.useState(!1),[G,L]=r.useState(null),E=r.useRef(null),c=JSON.parse(sessionStorage.getItem("user")),C=(c==null?void 0:c.accessToken)||"",m={"Content-type":"application/json",Authorization:`Bearer ${C}`},$="https://executivetracking.cloudjiffy.net/Mahaasabha/file/downloadFile/?filePath=",F=async()=>{try{const a=(await re(m)).data.content;if(a){const s=a.map(i=>({advertisementId:i.advertisementId,advertisementName:i.advertisementName,description:i.description,file:i.filePath===null?"NO IMAGE FOUND":t.jsx("img",{src:$+i.filePath,alt:i.fileName,style:{width:100,height:50}}),insertedDate:k(i.insertedDate).format("L"),updatedDate:k(i.updatedDate).format("L"),createdBy:i.createdBy?i.createdBy.userName:"No User",updatedBy:i.updatedBy?i.updatedBy.userName:"No User"}));N(s)}else N([])}catch(e){console.error("Error fetching data:",e)}};r.useEffect(()=>{F()},[z]);const J=async e=>{if(e.preventDefault(),!x){I("Please select a file");return}const a=new FormData;a.append("file",x);try{const s=await se.post("https://executivetracking.cloudjiffy.net/Mahaasabha/file/uploadFile",a,{headers:{"content-type":"multipart/form-data",Authorization:`Bearer ${C}`}});S(s.data.fileName),l({...n,fileName:s.data.fileName}),I(""),alert("File uploaded successfully")}catch(s){console.error("Error uploading file:",s)}},_=async e=>{e.preventDefault();const a=K();if(Object.keys(a).length>0)D(a);else try{if(x&&await J(e),p){const s={...n,advertisementId:G,updatedBy:{userId:c.userId}};await ie(s,m)}else await ne(n,m);l({advertisementName:"",description:"",fileName:""}),E.current.value=null,H(s=>!s),d(!1)}catch(s){console.error("Error saving advertisement:",s)}},q=e=>{S(e.target.files[0].name),O(e.target.files[0])},K=()=>{const e={};return(!n.advertisementName||n.advertisementName.trim()==="")&&(e.advertisementName="Enter the Advertisement name"),(!n.description||n.description.trim()==="")&&(e.description="Enter the description"),g||(e.fileName="Select and upload a file first"),e},T=e=>{l({...n,[e.target.name]:e.target.value,createdBy:{userId:c.userId}}),D({...o,[e.target.name]:null})},Q=()=>{b(!1),l({advertisementName:"",description:"",fileName:""}),d(!0)},V=async e=>{b(!0),d(!0);try{const s=(await de(e,m)).data;L(s.advertisementId),l({advertisementName:s.advertisementName,description:s.description,fileName:s.fileName})}catch(a){console.error("Error fetching advertisement details:",a)}},X=async e=>{try{await le(e,m),F()}catch(a){console.error("Error deleting advertisement:",a)}};return t.jsxs(Z,{title:t.jsxs(w,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx("span",{children:"Banner"}),t.jsxs(f,{variant:"contained",color:"primary",sx:{display:"flex",alignItems:"center",fontSize:"15px"},onClick:Q,children:["Add",t.jsx(oe,{sx:{color:"#fff"}})]})]}),children:[t.jsx(ee,{container:!0,spacing:te}),t.jsxs(ae,{sx:{width:"100%",overflow:"hidden"},children:[t.jsx(ce,{sx:{maxHeight:440},children:t.jsxs(me,{stickyHeader:!0,"aria-label":"sticky table",children:[t.jsx(he,{children:t.jsx(U,{children:W.map(e=>t.jsx(v,{align:e.align,style:{minWidth:e.minWidth,fontWeight:600,fontSize:15},children:e.label},e.id))})}),t.jsx(fe,{children:y.slice(u*h,u*h+h).map(e=>t.jsxs(U,{hover:!0,role:"checkbox",tabIndex:-1,children:[W.map(a=>{const s=e[a.id];return t.jsx(v,{align:a.align,children:s},a.id)}),t.jsxs(v,{align:"right",children:[t.jsx(A,{onClick:()=>V(e.advertisementId),children:t.jsx(pe,{})}),t.jsx(A,{onClick:()=>X(e.advertisementId),children:t.jsx(ge,{})})]})]},e.advertisementId))})]})}),t.jsx(ue,{rowsPerPageOptions:[10,25,100],component:"div",count:y.length,rowsPerPage:h,page:u,onPageChange:(e,a)=>j(a),onRowsPerPageChange:e=>{M(+e.target.value),j(0)}})]}),t.jsx(xe,{open:R,onClose:()=>d(!1),maxWidth:"sm",fullWidth:!0,children:t.jsxs("form",{onSubmit:_,children:[t.jsx(ve,{children:p?"Update Advertisement":"Add Advertisement"}),t.jsxs(w,{sx:{p:2},children:[t.jsx(P,{margin:"normal",fullWidth:!0,label:"Advertisement Name",name:"advertisementName",value:n.advertisementName,onChange:T,error:!!o.advertisementName,helperText:o.advertisementName}),t.jsx(P,{margin:"normal",fullWidth:!0,label:"Description",name:"description",value:n.description,onChange:T,error:!!o.description,helperText:o.description}),t.jsxs(f,{variant:"contained",component:"label",children:["Upload File",t.jsx("input",{type:"file",hidden:!0,onChange:q,ref:E})]}),B&&t.jsx("span",{style:{color:"red"},children:B}),g&&t.jsxs("span",{children:["Selected File: ",g]})]}),t.jsxs(je,{children:[t.jsx(f,{onClick:()=>d(!1),children:"Cancel"}),t.jsx(f,{type:"submit",children:p?"Update":"Submit"})]})]})})]})};export{Ee as default};
